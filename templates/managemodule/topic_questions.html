{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PulsePrep - {{ breadcrumb.topic|default:"Topic" }} Questions</title>
    <link rel="stylesheet" href="{% static 'css/DAstyles.css' %}" />
    <link rel="stylesheet" href="{% static 'css/MQstyles.css' %}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
<!-- Sidebar Navigation -->
<aside class="sidebar">
  <div class="logo-container">
    <img src="{% static 'images/Logo.png' %}" alt="PulsePrep Logo" class="logo" />
  </div>
  <nav class="nav-menu">
    <a href="{% url 'dashboard' %}" class="nav-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
      <i class="fas fa-th-large"></i>
      <span>Dashboard</span>
    </a>
    <a href="{% url 'questionbank' %}" class="nav-item {% if request.resolver_match.url_name == 'questionbank' %}active{% endif %}">
      <i class="fas fa-question-circle"></i>
      <span>Manage Questions</span>
    </a>
    <a href="{% url 'manage_csv' %}" class="nav-item {% if request.resolver_match.url_name == 'manage_csv' %}active{% endif %}">
      <i class="fas fa-file-csv"></i>
      <span>Manage CSVs</span>
    </a>
    <a href="{% url 'managemodule' %}" class="nav-item {% if request.resolver_match.url_name == 'managemodule' %}active{% endif %}">
      <i class="fas fa-cubes"></i>
      <span>Modules</span>
    </a>
    <a href="/admin/user_management/customuser/" class="nav-item">
      <i class="fas fa-users"></i>
      <span>Manage Users</span>
    </a>
    <a href="{% url 'mocktest_list' %}" class="nav-item {% if request.resolver_match.url_name == 'mocktest_list' %}active{% endif %}">
      <i class="fas fa-vial"></i>
      <span>Mock Tests</span>
    </a>
    <a href="{% url 'analytics_report' %}" class="nav-item {% if request.resolver_match.url_name == 'analytics_report' %}active{% endif %}">
      <i class="fas fa-chart-bar"></i>
      <span>Analytics & Reports</span>
    </a>
    <a href="{% url 'myaccount' %}" class="nav-item {% if request.resolver_match.url_name == 'myaccount' %}active{% endif %}">
      <i class="fas fa-user"></i>
      <span>My Account</span>
    </a>
    <a href="{% url 'notificationsetting' %}" class="nav-item {% if request.resolver_match.url_name == 'notificationsetting' %}active{% endif %}">
      <i class="fas fa-bell"></i>
      <span>Notifications</span>
      <span class="notification-badge-sidebar"></span>
    </a>
    <a href="{% url 'logout' %}" class="nav-item">
      <i class="fas fa-sign-out-alt"></i>
      <span>Logout</span>
    </a>
  </nav>
</aside>

      <!-- Main Content -->
      <main class="main-content">
        <header class="header">
          <div class="mobile-menu">
            <button id="sidebar-toggle">
              <i class="fas fa-bars"></i>
            </button>
          </div>
          <h1>
            <i class="fas fa-bookmark"></i>
            {{ breadcrumb.topic|default:"Topic" }} Questions
          </h1>
          <div class="user-menu">
            <a href="{% url 'notificationsetting' %}"><i class="fas fa-bell"></i></a>
            <div class="avatar">
              <img src="https://i.pravatar.cc/40?img=12" alt="User Avatar" />
            </div>
          </div>
        </header>

        <!-- Content -->
        <div class="dashboard-content">
          
          <!-- Enhanced Navigation & Breadcrumb -->
          <div class="topic-navigation">
            <div class="navigation-header">
              <div class="back-navigation">
                <a href="{% url 'managemodule' %}" class="back-btn">
                  <i class="fas fa-arrow-left"></i> Back to Modules
                </a>
              </div>
              
              <div class="topic-actions">
                <a href="{% url 'questionbank' %}?topic={{ breadcrumb.topic }}" class="action-link" title="View in Question Bank">
                  <i class="fas fa-external-link-alt"></i> View All
                </a>
                <a href="{% url 'manage_csv' %}" class="action-link" title="Import Questions">
                  <i class="fas fa-file-import"></i> Import
                </a>
              </div>
            </div>
            
            <div class="enhanced-breadcrumb">
              <div class="breadcrumb-path">
                <div class="breadcrumb-item">
                  <div class="breadcrumb-icon">
                    <i class="fas fa-layer-group"></i>
                  </div>
                  <div class="breadcrumb-content">
                    <span class="breadcrumb-label">Block</span>
                    <span class="breadcrumb-value">{{ breadcrumb.block|default:"General" }}</span>
                  </div>
                </div>
                
                <i class="fas fa-chevron-right breadcrumb-separator"></i>
                
                <div class="breadcrumb-item">
                  <div class="breadcrumb-icon">
                    <i class="fas fa-cube"></i>
                  </div>
                  <div class="breadcrumb-content">
                    <span class="breadcrumb-label">Module</span>
                    <span class="breadcrumb-value">{{ breadcrumb.module|default:"General" }}</span>
                  </div>
                </div>
                
                <i class="fas fa-chevron-right breadcrumb-separator"></i>
                
                <div class="breadcrumb-item">
                  <div class="breadcrumb-icon">
                    <i class="fas fa-book"></i>
                  </div>
                  <div class="breadcrumb-content">
                    <span class="breadcrumb-label">Subject</span>
                    <span class="breadcrumb-value">{{ breadcrumb.subject|default:"General" }}</span>
                  </div>
                </div>
                
                <i class="fas fa-chevron-right breadcrumb-separator"></i>
                
                <div class="breadcrumb-item active">
                  <div class="breadcrumb-icon">
                    <i class="fas fa-bookmark"></i>
                  </div>
                  <div class="breadcrumb-content">
                    <span class="breadcrumb-label">Topic</span>
                    <span class="breadcrumb-value">{{ breadcrumb.topic|default:"General" }}</span>
                  </div>
                </div>
              </div>
              
              <div class="topic-meta">
                <div class="meta-item">
                  <i class="fas fa-graduation-cap"></i>
                  <span class="meta-label">Degree:</span>
                  <span class="meta-value topic-degree">{{ breadcrumb.degree|default:"MBBS" }}</span>
                </div>
                <div class="meta-item">
                  <i class="fas fa-calendar-check"></i>
                  <span class="meta-label">Year:</span>
                  <span class="meta-value topic-year">{{ breadcrumb.year|default:"1st" }}</span>
                </div>
                <div class="meta-item">
                  <i class="fas fa-list-ol"></i>
                  <span class="meta-label">Questions:</span>
                  <span class="meta-value topic-count">{{ total_questions|default:"0" }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Topic Statistics -->
          <div class="topic-stats-section">
            <h2><i class="fas fa-chart-pie"></i> Topic Overview</h2>
            <div class="stats-cards">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-question-circle"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ total_questions|default:"0" }}</h3>
                  <p>Total Questions</p>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-list-alt"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ mcq_count|default:"0" }}</h3>
                  <p>MCQ Questions</p>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-edit"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ essay_count|default:"0" }}</h3>
                  <p>Essay Questions</p>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-sticky-note"></i>
                </div>
                <div class="stat-content">
                  <h3>{{ notes_count|default:"0" }}</h3>
                  <p>Notes</p>
                </div>
              </div>
            </div>
            
            <!-- Difficulty Distribution for this topic -->
            <div class="difficulty-stats">
              <h3><i class="fas fa-tachometer-alt"></i> Difficulty Distribution</h3>
              <div class="difficulty-bars">
                <div class="difficulty-item">
                  <span class="difficulty-label">Easy</span>
                  <div class="difficulty-bar">
                    <div class="difficulty-fill easy" style="width: {% if total_questions > 0 %}{% widthratio easy_count total_questions 100 %}{% else %}0{% endif %}%"></div>
                  </div>
                  <span class="difficulty-count">{{ easy_count|default:"0" }}</span>
                </div>
                <div class="difficulty-item">
                  <span class="difficulty-label">Medium</span>
                  <div class="difficulty-bar">
                    <div class="difficulty-fill medium" style="width: {% if total_questions > 0 %}{% widthratio medium_count total_questions 100 %}{% else %}0{% endif %}%"></div>
                  </div>
                  <span class="difficulty-count">{{ medium_count|default:"0" }}</span>
                </div>
                <div class="difficulty-item">
                  <span class="difficulty-label">Hard</span>
                  <div class="difficulty-bar">
                    <div class="difficulty-fill hard" style="width: {% if total_questions > 0 %}{% widthratio hard_count total_questions 100 %}{% else %}0{% endif %}%"></div>
                  </div>
                  <span class="difficulty-count">{{ hard_count|default:"0" }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Enhanced Search Controls -->
          <div class="question-bank-controls">
            <div class="controls-left">
              <form method="GET" class="search-form">
                <!-- Preserve breadcrumb parameters -->
                <input type="hidden" name="block" value="{{ breadcrumb.block }}">
                <input type="hidden" name="module" value="{{ breadcrumb.module }}">
                <input type="hidden" name="subject" value="{{ breadcrumb.subject }}">
                <input type="hidden" name="topic" value="{{ breadcrumb.topic }}">
                <input type="hidden" name="degree" value="{{ breadcrumb.degree }}">
                <input type="hidden" name="year" value="{{ breadcrumb.year }}">
                
                <div class="search-container">
                  <input
                    type="text"
                    placeholder="Search questions in this topic..."
                    class="search-input"
                    name="q"
                    value="{{ query|default:'' }}"
                  />
                  <button type="submit" class="search-button">
                    <i class="fas fa-search search-icon"></i>
                  </button>
                </div>
                
                <div class="filter-container">
                  <select class="filter-select" name="type" onchange="this.form.submit()">
                    <option value="" {% if not filter_type %}selected{% endif %}>All Types</option>
                    <option value="MCQ" {% if filter_type == 'MCQ' %}selected{% endif %}>Multiple Choice</option>
                    <option value="SEQ" {% if filter_type == 'SEQ' %}selected{% endif %}>Short Essay</option>
                    <option value="NOTE" {% if filter_type == 'NOTE' %}selected{% endif %}>Notes</option>
                  </select>
                </div>
                
                <div class="filter-container">
                  <select class="filter-select" name="difficulty" onchange="this.form.submit()">
                    <option value="" {% if not filter_difficulty %}selected{% endif %}>All Difficulties</option>
                    <option value="Easy" {% if filter_difficulty == 'Easy' %}selected{% endif %}>Easy</option>
                    <option value="Medium" {% if filter_difficulty == 'Medium' %}selected{% endif %}>Medium</option>
                    <option value="Hard" {% if filter_difficulty == 'Hard' %}selected{% endif %}>Hard</option>
                  </select>
                </div>
              </form>
            </div>
            
            <div class="controls-right">
              <a href="{% url 'questionbank' %}?block={{ breadcrumb.block }}&module={{ breadcrumb.module }}&subject={{ breadcrumb.subject }}&topic={{ breadcrumb.topic }}" class="btn-secondary">
                <i class="fas fa-external-link-alt"></i> View in Bank
              </a>
              <a href="{% url 'add_question' %}?topic={{ breadcrumb.topic }}&subject={{ breadcrumb.subject }}&module={{ breadcrumb.module }}&block={{ breadcrumb.block }}" class="btn-primary">
                <i class="fas fa-plus"></i> Add Question
              </a>
            </div>
          </div>

          <!-- Messages -->
          {% if messages %}
            <div class="messages">
              {% for message in messages %}
                <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
                  {% if message.tags == 'success' %}
                    <i class="fas fa-check-circle"></i>
                  {% elif message.tags == 'error' %}
                    <i class="fas fa-exclamation-circle"></i>
                  {% elif message.tags == 'warning' %}
                    <i class="fas fa-exclamation-triangle"></i>
                  {% else %}
                    <i class="fas fa-info-circle"></i>
                  {% endif %}
                  {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
          
          <!-- Enhanced Questions Section -->
          <div class="questions-section">
            <div class="section-header">
              <h2><i class="fas fa-list"></i> Questions in {{ breadcrumb.topic|default:"This Topic" }}</h2>
              <div class="section-actions">
                {% if page_obj %}
                  <div class="results-summary">
                    Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }} questions
                    {% if query %} for "{{ query }}"{% endif %}
                  </div>
                {% endif %}
                
                <div class="view-options">
                  <button class="view-toggle active" data-view="table" title="Table View">
                    <i class="fas fa-table"></i>
                  </button>
                  <button class="view-toggle" data-view="cards" title="Card View">
                    <i class="fas fa-th-large"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Table View -->
            <div class="question-view table-view active">
              <div class="question-list">
                <table class="questions-table">
                  <thead>
                    <tr>
                      <th><i class="fas fa-hashtag"></i> #</th>
                      <th><i class="fas fa-question"></i> Question Text</th>
                      <th><i class="fas fa-tag"></i> Type</th>
                      <th><i class="fas fa-tachometer-alt"></i> Difficulty</th>
                      <th><i class="fas fa-calendar"></i> Created</th>
                      <th><i class="fas fa-user"></i> Author</th>
                      <th><i class="fas fa-cog"></i> Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for question in page_obj %}
                      <tr class="question-row" data-question-id="{{ question.id }}">
                        <td class="question-number">
                          {{ forloop.counter|add:page_obj.start_index|add:"-1" }}
                        </td>
                        <td class="question-text">
                          <span class="question-preview" title="{{ question.question_text }}">
                            {{ question.question_text|truncatechars:80 }}
                          </span>
                          {% if question.question_text|length > 80 %}
                            <button class="expand-btn" data-full-text="{{ question.question_text }}">
                              <i class="fas fa-expand-alt"></i>
                            </button>
                          {% endif %}
                        </td>
                        <td>
                          <span class="type-badge {{ question.question_type|lower }}">
                            {% if question.question_type == 'MCQ' %}
                              <i class="fas fa-list-alt"></i> MCQ
                            {% elif question.question_type == 'SEQ' %}
                              <i class="fas fa-edit"></i> Essay
                            {% else %}
                              <i class="fas fa-sticky-note"></i> Notes
                            {% endif %}
                          </span>
                        </td>
                        <td>
                          <span class="difficulty-badge {{ question.difficulty|lower }}">
                            {% if question.difficulty == 'Easy' %}
                              <i class="fas fa-circle" style="color: #10b981;"></i>
                            {% elif question.difficulty == 'Medium' %}
                              <i class="fas fa-circle" style="color: #f59e0b;"></i>
                            {% else %}
                              <i class="fas fa-circle" style="color: #ef4444;"></i>
                            {% endif %}
                            {{ question.difficulty }}
                          </span>
                        </td>
                        <td class="created-date">
                          <div class="date-info">
                            <span class="date">{{ question.created_on|date:"M d, Y" }}</span>
                            <span class="time">{{ question.created_on|time:"H:i" }}</span>
                          </div>
                        </td>
                        <td class="author-info">
                          <div class="author-details">
                            <span class="author-name">{{ question.created_by.get_full_name|default:question.created_by.email|truncatechars:20 }}</span>
                          </div>
                        </td>
                        <td class="actions">
                          <div class="action-buttons">
                            <button class="btn-icon preview-btn" data-question-id="{{ question.id }}" title="Preview Question">
                              <i class="fas fa-eye"></i>
                            </button>
                            <a href="{% url 'edit_question' question.id %}" class="btn-icon" title="Edit Question">
                              <i class="fas fa-edit"></i>
                            </a>
                            <a href="{% url 'delete_question' question.id %}" class="btn-icon delete-btn" title="Delete Question">
                              <i class="fas fa-trash"></i>
                            </a>
                          </div>
                        </td>
                      </tr>
                    {% empty %}
                      <tr>
                        <td colspan="7" class="no-data">
                          <div class="no-data-content">
                            <i class="fas fa-search"></i>
                            <h3>No Questions Found</h3>
                            <p>No questions found for this topic{% if query %} matching "{{ query }}"{% endif %}.</p>
                            <div class="no-data-actions">
                              <a href="{% url 'add_question' %}?topic={{ breadcrumb.topic }}" class="btn-primary">
                                <i class="fas fa-plus"></i> Add First Question
                              </a>
                              {% if query %}
                                <a href="?block={{ breadcrumb.block }}&module={{ breadcrumb.module }}&subject={{ breadcrumb.subject }}&topic={{ breadcrumb.topic }}" class="btn-secondary">
                                  <i class="fas fa-times"></i> Clear Search
                                </a>
                              {% endif %}
                            </div>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Card View -->
            <div class="question-view card-view" style="display: none;">
              <div class="question-cards">
                {% for question in page_obj %}
                  <div class="question-card" data-question-id="{{ question.id }}">
                    <div class="card-header">
                      <div class="card-number">
                        #{{ forloop.counter|add:page_obj.start_index|add:"-1" }}
                      </div>
                      <div class="card-actions">
                        <button class="btn-icon preview-btn" data-question-id="{{ question.id }}" title="Preview">
                          <i class="fas fa-eye"></i>
                        </button>
                        <a href="{% url 'edit_question' question.id %}" class="btn-icon" title="Edit">
                          <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'delete_question' question.id %}" class="btn-icon delete-btn" title="Delete">
                          <i class="fas fa-trash"></i>
                        </a>
                      </div>
                    </div>
                    
                    <div class="card-content">
                      <div class="question-text">
                        {{ question.question_text|truncatechars:120 }}
                      </div>
                      
                      <div class="card-meta">
                        <div class="meta-row">
                          <span class="type-badge {{ question.question_type|lower }}">
                            {{ question.get_question_type_display }}
                          </span>
                          <span class="difficulty-badge {{ question.difficulty|lower }}">
                            {{ question.difficulty }}
                          </span>
                        </div>
                        
                        <div class="meta-row">
                          <span class="meta-item">
                            <i class="fas fa-calendar"></i>
                            {{ question.created_on|date:"M d, Y" }}
                          </span>
                          <span class="meta-item">
                            <i class="fas fa-user"></i>
                            {{ question.created_by.get_full_name|default:question.created_by.email|truncatechars:15 }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
            
            <!-- Pagination -->
            {% if page_obj.has_other_pages %}
              <div class="pagination">
                {% if page_obj.has_previous %}
                  <a href="?page=1&block={{ breadcrumb.block }}&module={{ breadcrumb.module }}&subject={{ breadcrumb.subject }}&topic={{ breadcrumb.topic }}&degree={{ breadcrumb.degree }}&year={{ breadcrumb.year }}{% if query %}&q={{ query }}{% endif %}{% if filter_type %}&type={{ filter_type }}{% endif %}{% if filter_difficulty %}&difficulty={{ filter_difficulty }}{% endif %}" class="pagination-link">
                    <i class="fas fa-angle-double-left"></i> First
                  </a>
                  <a href="?page={{ page_obj.previous_page_number }}&block={{ breadcrumb.block }}&module={{ breadcrumb.module }}&subject={{ breadcrumb.subject }}&topic={{ breadcrumb.topic }}&degree={{ breadcrumb.degree }}&year={{ breadcrumb.year }}{% if query %}&q={{ query }}{% endif %}{% if filter_type %}&type={{ filter_type }}{% endif %}{% if filter_difficulty %}&difficulty={{ filter_difficulty }}{% endif %}" class="pagination-link">
                    <i class="fas fa-angle-left"></i> Prev
                  </a>
                {% endif %}
                
                {% for num in page_obj.paginator.page_range %}
                  {% if page_obj.number == num %}
                    <span class="pagination-link active">{{ num }}</span>
                  {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}&block={{ breadcrumb.block }}&module={{ breadcrumb.module }}&subject={{ breadcrumb.subject }}&topic={{ breadcrumb.topic }}&degree={{ breadcrumb.degree }}&year={{ breadcrumb.year }}{% if query %}&q={{ query }}{% endif %}{% if filter_type %}&type={{ filter_type }}{% endif %}{% if filter_difficulty %}&difficulty={{ filter_difficulty }}{% endif %}" class="pagination-link">{{ num }}</a>
                  {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}&block={{ breadcrumb.block }}&module={{ breadcrumb.module }}&subject={{ breadcrumb.subject }}&topic={{ breadcrumb.topic }}&degree={{ breadcrumb.degree }}&year={{ breadcrumb.year }}{% if query %}&q={{ query }}{% endif %}{% if filter_type %}&type={{ filter_type }}{% endif %}{% if filter_difficulty %}&difficulty={{ filter_difficulty }}{% endif %}" class="pagination-link">
                    Next <i class="fas fa-angle-right"></i>
                  </a>
                  <a href="?page={{ page_obj.paginator.num_pages }}&block={{ breadcrumb.block }}&module={{ breadcrumb.module }}&subject={{ breadcrumb.subject }}&topic={{ breadcrumb.topic }}&degree={{ breadcrumb.degree }}&year={{ breadcrumb.year }}{% if query %}&q={{ query }}{% endif %}{% if filter_type %}&type={{ filter_type }}{% endif %}{% if filter_difficulty %}&difficulty={{ filter_difficulty }}{% endif %}" class="pagination-link">
                    Last <i class="fas fa-angle-double-right"></i>
                  </a>
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
          <div class="social-links">
            <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
          </div>
          <div class="copyright">
            &copy; {{ current_year|default:"2024" }} PulsePrep Media Direct, LLC. All rights reserved.
          </div>
        </footer>
      </main>
    </div>

    <!-- Question Preview Modal -->
    <div id="question-preview-modal" class="modal" style="display: none;">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h3><i class="fas fa-eye"></i> Question Preview</h3>
          <button class="close-modal" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
          <div id="question-preview-content">
            <!-- Preview content will be loaded here -->
          </div>
        </div>
      </div>
    </div>

    <script src="{% static 'js/DAscript.js' %}"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Animate sections on page load
        const sections = document.querySelectorAll('.topic-navigation, .topic-stats-section, .question-bank-controls, .questions-section');
        sections.forEach((section, index) => {
          section.style.opacity = '0';
          section.style.transform = 'translateY(20px)';
          
          setTimeout(() => {
            section.style.transition = 'all 0.5s ease';
            section.style.opacity = '1';
            section.style.transform = 'translateY(0)';
          }, index * 150);
        });

        // Animate difficulty bars
        setTimeout(() => {
          const difficultyFills = document.querySelectorAll('.difficulty-fill');
          difficultyFills.forEach(fill => {
            const targetWidth = fill.style.width;
            fill.style.width = '0%';
            
            setTimeout(() => {
              fill.style.width = targetWidth;
            }, 200);
          });
        }, 500);

        // View toggle functionality
        const viewToggles = document.querySelectorAll('.view-toggle');
        const tableView = document.querySelector('.table-view');
        const cardView = document.querySelector('.card-view');

        viewToggles.forEach(toggle => {
          toggle.addEventListener('click', function() {
            const view = this.dataset.view;
            
            // Update active state
            viewToggles.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Toggle views
            if (view === 'table') {
              tableView.style.display = 'block';
              cardView.style.display = 'none';
              tableView.classList.add('active');
              cardView.classList.remove('active');
            } else {
              tableView.style.display = 'none';
              cardView.style.display = 'block';
              cardView.classList.add('active');
              tableView.classList.remove('active');
            }
          });
        });

        // Question text expand functionality
        document.querySelectorAll('.expand-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const fullText = this.dataset.fullText;
            const preview = this.parentElement.querySelector('.question-preview');
            
            if (this.classList.contains('expanded')) {
              preview.textContent = fullText.substring(0, 77) + '...';
              this.innerHTML = '<i class="fas fa-expand-alt"></i>';
              this.classList.remove('expanded');
            } else {
              preview.textContent = fullText;
              this.innerHTML = '<i class="fas fa-compress-alt"></i>';
              this.classList.add('expanded');
            }
          });
        });

        // Question preview functionality
        document.querySelectorAll('.preview-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const questionId = this.dataset.questionId;
            showQuestionPreview(questionId);
          });
        });

        function showQuestionPreview(questionId) {
          // In a real implementation, you would fetch question details via AJAX
          // For now, we'll show a placeholder
          const modal = document.getElementById('question-preview-modal');
          const content = document.getElementById('question-preview-content');
          
          content.innerHTML = `
            <div class="preview-loading">
              <i class="fas fa-spinner fa-spin"></i>
              <p>Loading question details...</p>
            </div>
          `;
          
          modal.style.display = 'block';
          
          // Simulate loading
          setTimeout(() => {
            content.innerHTML = `
              <div class="question-preview">
                <div class="preview-header">
                  <h4>Question #${questionId}</h4>
                  <div class="preview-meta">
                    <span class="type-badge mcq"><i class="fas fa-list-alt"></i> Multiple Choice</span>
                    <span class="difficulty-badge medium"><i class="fas fa-circle"></i> Medium</span>
                  </div>
                </div>
                
                <div class="preview-content">
                  <div class="question-text">
                    <h5>Question:</h5>
                    <p>This is a sample question text that would be loaded from the database. It contains the full question content with proper formatting.</p>
                  </div>
                  
                  <div class="question-options">
                    <h5>Options:</h5>
                    <div class="options-list">
                      <div class="option-item">
                        <span class="option-label">A</span>
                        <span class="option-text">First option text</span>
                      </div>
                      <div class="option-item">
                        <span class="option-label">B</span>
                        <span class="option-text">Second option text</span>
                      </div>
                      <div class="option-item correct">
                        <span class="option-label">C</span>
                        <span class="option-text">Correct option text</span>
                        <i class="fas fa-check-circle"></i>
                      </div>
                      <div class="option-item">
                        <span class="option-label">D</span>
                        <span class="option-text">Fourth option text</span>
                      </div>
                      <div class="option-item">
                        <span class="option-label">E</span>
                        <span class="option-text">Fifth option text</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="question-explanation">
                    <h5>Explanation:</h5>
                    <p>This is the explanation for why option C is correct. It provides detailed reasoning and additional context to help students understand the concept.</p>
                  </div>
                  
                  <div class="question-details">
                    <div class="detail-grid">
                      <div class="detail-item">
                        <span class="detail-label">Created:</span>
                        <span class="detail-value">Jan 15, 2024</span>
                      </div>
                      <div class="detail-item">
                        <span class="detail-label">Author:</span>
                        <span class="detail-value">Dr. Smith</span>
                      </div>
                      <div class="detail-item">
                        <span class="detail-label">Module:</span>
                        <span class="detail-value">${document.querySelector('.breadcrumb-value').textContent}</span>
                      </div>
                      <div class="detail-item">
                        <span class="detail-label">Subject:</span>
                        <span class="detail-value">${document.querySelectorAll('.breadcrumb-value')[2].textContent}</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="preview-actions">
                  <a href="/questions/edit/${questionId}/" class="btn-primary">
                    <i class="fas fa-edit"></i> Edit Question
                  </a>
                  <button class="btn-secondary close-modal">
                    <i class="fas fa-times"></i> Close
                  </button>
                </div>
              </div>
            `;
          }, 800);
        }

        // Close modal functionality
        document.querySelectorAll('.close-modal').forEach(btn => {
          btn.addEventListener('click', function() {
            this.closest('.modal').style.display = 'none';
          });
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
          if (e.target.classList.contains('modal')) {
            e.target.style.display = 'none';
          }
        });

        // Enhanced search functionality
        const searchInput = document.querySelector('.search-input');
        const searchForm = document.querySelector('.search-form');
        
        if (searchInput) {
          searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
              e.preventDefault();
              searchForm.submit();
            }
          });
        }

        // Filter change handlers with loading states
        const filterSelects = document.querySelectorAll('.filter-select');
        filterSelects.forEach(select => {
          select.addEventListener('change', function() {
            // Add loading state
            this.style.opacity = '0.6';
            this.disabled = true;
            
            // Submit form after brief delay
            setTimeout(() => {
              this.closest('form').submit();
            }, 200);
          });
        });

        // Row hover effects
        document.querySelectorAll('.question-row').forEach(row => {
          row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f9fafb';
          });
          
          row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
          });
        });

        // Card hover effects
        document.querySelectorAll('.question-card').forEach(card => {
          card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
          });
          
          card.addEventListener('mouseleave', function() {
            this.style.transform = '';
            this.style.boxShadow = '';
          });
        });

        // Confirmation for delete actions
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (confirm('Are you sure you want to delete this question? This action cannot be undone.')) {
              window.location.href = this.href;
            }
          });
        });

        // Auto-submit filters with debounce
        let filterTimeout;
        document.querySelectorAll('.filter-select').forEach(select => {
          select.addEventListener('change', function() {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
              this.form.submit();
            }, 300);
          });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
          // Press 'S' to focus search
          if (e.key === 's' && !e.ctrlKey && !e.metaKey && e.target.tagName !== 'INPUT') {
            e.preventDefault();
            const searchInput = document.querySelector('.search-input');
            if (searchInput) {
              searchInput.focus();
            }
          }
          
          // Press 'Escape' to close modals
          if (e.key === 'Escape') {
            const openModal = document.querySelector('.modal[style*="block"]');
            if (openModal) {
              openModal.style.display = 'none';
            }
          }
        });

        // Auto-save user preferences
        const saveUserPreferences = () => {
          const preferences = {
            view: document.querySelector('.view-toggle.active')?.dataset.view || 'table',
            timestamp: Date.now()
          };
          try {
            localStorage.setItem('pulseprep_topic_preferences', JSON.stringify(preferences));
          } catch (e) {
            console.log('Could not save preferences');
          }
        };

        const loadUserPreferences = () => {
          try {
            const saved = localStorage.getItem('pulseprep_topic_preferences');
            if (saved) {
              const preferences = JSON.parse(saved);
              // Load saved view preference
              const viewToggle = document.querySelector(`[data-view="${preferences.view}"]`);
              if (viewToggle && preferences.view !== 'table') {
                viewToggle.click();
              }
            }
          } catch (e) {
            console.log('Could not load user preferences');
          }
        };

        // Save preferences when view changes
        document.querySelectorAll('.view-toggle').forEach(toggle => {
          toggle.addEventListener('click', saveUserPreferences);
        });

        // Load preferences on page load
        loadUserPreferences();
      });
    </script>
    
    <style>
      /* Enhanced Topic Navigation Styles */
      .topic-navigation {
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 25px;
        border: 1px solid #e5e7eb;
        border-top: 3px solid #82272e;
      }

      .navigation-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .topic-actions {
        display: flex;
        gap: 10px;
      }

      .action-link {
        color: #82272e;
        text-decoration: none;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 4px;
        font-size: 13px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .action-link:hover {
        background: #f9fafb;
        border-color: #82272e;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(130, 39, 46, 0.2);
      }

      .enhanced-breadcrumb {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .breadcrumb-path {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .breadcrumb-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 15px;
        background: #f9fafb;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
        min-width: 120px;
      }

      .breadcrumb-item.active {
        background: rgba(130, 39, 46, 0.1);
        border-color: #82272e;
        animation: slideIn 0.5s ease;
      }

      .breadcrumb-icon {
        width: 30px;
        height: 30px;
        background: rgba(130, 39, 46, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #82272e;
        font-size: 12px;
        flex-shrink: 0;
      }

      .breadcrumb-content {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .breadcrumb-label {
        font-size: 11px;
        color: #6b7280;
        text-transform: uppercase;
        font-weight: 500;
      }

      .breadcrumb-value {
        font-size: 13px;
        color: #1f2937;
        font-weight: 600;
      }

      .breadcrumb-separator {
        color: #d1d5db;
        font-size: 12px;
      }

      .topic-meta {
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
      }

      .meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: #6b7280;
      }

      .meta-item i {
        color: #82272e;
      }

      .meta-label {
        font-weight: 500;
      }

      .meta-value {
        font-weight: 600;
        color: #1f2937;
      }

      /* Topic Statistics */
      .topic-stats-section {
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 25px;
        border: 1px solid #e5e7eb;
        border-top: 3px solid #10b981;
      }

      .topic-stats-section h2 {
        margin-top: 0;
        margin-bottom: 20px;
        color: #10b981;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
      }

      /* Enhanced Section Header */
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .section-header h2 {
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-actions {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .results-summary {
        font-size: 13px;
        color: #6b7280;
        font-style: italic;
      }

      .view-options {
        display: flex;
        background: #f3f4f6;
        border-radius: 6px;
        padding: 2px;
      }

      .view-toggle {
        background: none;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        color: #6b7280;
        transition: all 0.3s ease;
      }

      .view-toggle.active {
        background: white;
        color: #82272e;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      /* Enhanced Table Styles */
      .question-number {
        font-weight: 600;
        color: #82272e;
        text-align: center;
        width: 50px;
      }

      .question-text {
        max-width: 300px;
        position: relative;
      }

      .question-preview {
        display: block;
        line-height: 1.4;
      }

      .expand-btn {
        background: none;
        border: none;
        color: #82272e;
        cursor: pointer;
        font-size: 12px;
        margin-left: 8px;
        padding: 2px 4px;
        border-radius: 3px;
        transition: background 0.3s ease;
      }

      .expand-btn:hover {
        background: rgba(130, 39, 46, 0.1);
      }

      .type-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
        width: fit-content;
      }

      .type-badge.mcq {
        background: rgba(59, 130, 246, 0.1);
        color: #2563eb;
      }

      .type-badge.seq {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
      }

      .type-badge.note {
        background: rgba(139, 92, 246, 0.1);
        color: #7c3aed;
      }

      .created-date {
        min-width: 100px;
      }

      .date-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .date {
        font-weight: 500;
        color: #1f2937;
        font-size: 13px;
      }

      .time {
        font-size: 11px;
        color: #6b7280;
      }

      .author-info {
        min-width: 120px;
      }

      .author-details {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .author-name {
        font-weight: 500;
        color: #1f2937;
        font-size: 13px;
      }

      .action-buttons {
        display: flex;
        gap: 4px;
      }

      /* Card View Styles */
      .question-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
      }

      .question-card {
        background: white;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
        overflow: hidden;
      }

      .question-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        animation: pulse 0.3s ease;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
      }

      .card-number {
        font-weight: 600;
        color: #82272e;
        font-size: 14px;
      }

      .card-actions {
        display: flex;
        gap: 4px;
      }

      .card-content {
        padding: 20px;
      }

      .card-content .question-text {
        margin-bottom: 15px;
        line-height: 1.5;
        color: #1f2937;
      }

      .card-meta {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .meta-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .meta-item {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 12px;
        color: #6b7280;
      }

      /* Enhanced No Data Styles */
      .no-data-content {
        text-align: center;
        padding: 60px 20px;
      }

      .no-data-content i {
        font-size: 48px;
        color: #d1d5db;
        margin-bottom: 20px;
      }

      .no-data-content h3 {
        margin: 0 0 10px 0;
        color: #6b7280;
        font-size: 20px;
      }

      .no-data-content p {
        margin: 0 0 25px 0;
        color: #9ca3af;
        font-size: 14px;
      }

      .no-data-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* Modal Enhancements */
      .modal-large .modal-content {
        max-width: 800px;
        width: 95%;
      }

      .preview-loading {
        text-align: center;
        padding: 40px;
        color: #6b7280;
      }

      .preview-loading i {
        font-size: 24px;
        margin-bottom: 10px;
      }

      .question-preview {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 15px;
        border-bottom: 2px solid #f3f4f6;
      }

      .preview-header h4 {
        margin: 0;
        color: #1f2937;
        font-size: 18px;
      }

      .preview-meta {
        display: flex;
        gap: 10px;
      }

      .preview-content h5 {
        margin: 0 0 10px 0;
        color: #374151;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .options-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .option-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px;
        background: #f9fafb;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
        position: relative;
      }

      .option-item.correct {
        background: rgba(16, 185, 129, 0.1);
        border-color: #10b981;
      }

      .option-item.correct .option-label {
        background: #10b981;
      }

      .option-item .option-label {
        width: 24px;
        height: 24px;
        background: #82272e;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        flex-shrink: 0;
      }

      .option-text {
        flex: 1;
        font-size: 14px;
        color: #374151;
      }

      .option-item.correct i {
        color: #10b981;
        font-size: 16px;
      }

      .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        padding: 15px;
        background: #f9fafb;
        border-radius: 6px;
      }

      .detail-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .detail-label {
        font-size: 12px;
        color: #6b7280;
        font-weight: 500;
      }

      .detail-value {
        font-size: 13px;
        color: #1f2937;
        font-weight: 600;
      }

      .preview-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        padding-top: 20px;
        border-top: 2px solid #f3f4f6;
      }

      /* Enhanced Hover Effects */
      .btn-icon:hover {
        transform: scale(1.1);
        transition: transform 0.2s ease;
      }

      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      /* Focus States for Accessibility */
      .btn-icon:focus,
      .action-link:focus,
      .view-toggle:focus {
        outline: 2px solid #82272e;
        outline-offset: 2px;
      }

      .search-input:focus,
      .filter-select:focus {
        outline: none;
        border-color: #82272e;
        box-shadow: 0 0 0 3px rgba(130, 39, 46, 0.1);
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes pulse {
        0%, 100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .question-row:hover {
        animation: fadeIn 0.3s ease;
      }

      /* Loading States */
      .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
      }

      .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #82272e;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .navigation-header {
          flex-direction: column;
          gap: 15px;
          align-items: stretch;
        }

        .breadcrumb-path {
          flex-direction: column;
          align-items: stretch;
        }

        .breadcrumb-item {
          min-width: auto;
        }

        .topic-meta {
          justify-content: center;
        }

        .section-header {
          flex-direction: column;
          align-items: stretch;
        }

        .section-actions {
          justify-content: space-between;
        }

        .question-cards {
          grid-template-columns: 1fr;
        }

        .no-data-actions {
          flex-direction: column;
          align-items: center;
        }

        .no-data-actions .btn-primary,
        .no-data-actions .btn-secondary {
          width: 100%;
          max-width: 250px;
          justify-content: center;
        }

        .preview-actions {
          flex-direction: column;
        }

        .preview-actions .btn-primary,
        .preview-actions .btn-secondary {
          width: 100%;
          justify-content: center;
        }
      }

      @media (max-width: 576px) {
        .topic-meta {
          flex-direction: column;
          align-items: center;
          gap: 10px;
        }

        .view-options {
          width: 100%;
          justify-content: center;
        }

        .results-summary {
          text-align: center;
        }

        .detail-grid {
          grid-template-columns: 1fr;
        }

        .modal-large .modal-content {
          width: 98%;
          margin: 10px;
        }

        .breadcrumb-separator {
          transform: rotate(90deg);
          margin: 5px 0;
        }
      }

      @media (max-width: 320px) {
        .topic-navigation,
        .topic-stats-section,
        .questions-section {
          padding: 15px;
          margin-bottom: 15px;
        }

        .stats-cards {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .breadcrumb-path {
          gap: 5px;
        }

        .breadcrumb-item {
          padding: 8px 10px;
          min-width: auto;
        }

        .section-header {
          flex-direction: column;
          gap: 10px;
        }

        .questions-table th,
        .questions-table td {
          padding: 6px 8px;
          font-size: 12px;
        }

        .question-cards {
          gap: 15px;
        }

        .question-card {
          border-radius: 6px;
        }

        .card-header,
        .card-content {
          padding: 12px 15px;
        }
      }
    </style>
  </body>
</html>