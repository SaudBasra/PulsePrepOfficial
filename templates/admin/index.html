
<!-- templates/admin/index.html - Enhanced Dashboard -->
{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
{% endblock %}

{% block content %}
<h1>{% trans 'PulsePrep Administration' %}</h1>

<!-- Email Quick Stats -->
<div class="dashboard-shortcuts">
    <h3>📧 Email System Status</h3>
    <div class="email-stats">
        <div class="stat-card">
            <div class="stat-number">{{ total_users|default:"0" }}</div>
            <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ pending_users|default:"0" }}</div>
            <div class="stat-label">Pending Approvals</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ activated_users|default:"0" }}</div>
            <div class="stat-label">Activated Users</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ failed_emails|default:"0" }}</div>
            <div class="stat-label">Failed Emails</div>
        </div>
    </div>
</div>

<!-- Quick Navigation -->
<div class="dashboard-shortcuts">
    <h3>🚀 Quick Navigation</h3>
    <div class="quick-links">
        <a href="{% url 'admin:user_management_customuser_changelist' %}" class="quick-link">
            👥 Manage Users
        </a>
        <a href="/admin/user_management/customuser/?approval_status__exact=pending" class="quick-link">
            ⏳ Pending Approvals ({{ pending_users|default:"0" }})
        </a>
        <a href="/admin/user_management/customuser/?approval_status__exact=approved&is_account_activated__exact=0" class="quick-link">
            📧 Need Activation ({{ pending_activation|default:"0" }})
        </a>
        <a href="{% url 'admin:user_management_emaillog_changelist' %}" class="quick-link">
            📊 Email Logs
        </a>
        <a href="{% url 'admin:email_dashboard' %}" class="quick-link">
            📈 Email Dashboard
        </a>

    </div>
</div>

<!-- Recent Activity -->
{% if recent_emails %}
<div class="dashboard-shortcuts">
    <h3>📮 Recent Email Activity</h3>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 8px; text-align: left;">User</th>
                <th style="padding: 8px; text-align: left;">Type</th>
                <th style="padding: 8px; text-align: left;">Status</th>
                <th style="padding: 8px; text-align: left;">Sent</th>
            </tr>
        </thead>
        <tbody>
            {% for email in recent_emails|slice:":5" %}
            <tr>
                <td style="padding: 8px;">{{ email.user.email }}</td>
                <td style="padding: 8px;">{{ email.get_email_type_display }}</td>
                <td style="padding: 8px;">
                    <span class="email-status-{{ email.status }}">{{ email.get_status_display }}</span>
                </td>
                <td style="padding: 8px;">{{ email.sent_at|date:"M d, H:i" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Default Django Admin Apps -->
{% if app_list %}
    {% for app in app_list %}
        <div class="app-{{ app.app_label }} module">
            <table>
                <caption>
                    <a href="{{ app.app_url }}" class="section" title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}">{{ app.name }}</a>
                </caption>
                {% for model in app.models %}
                    <tr class="model-{{ model.object_name|lower }}">
                        {% if model.admin_url %}
                            <th scope="row"><a href="{{ model.admin_url }}">{{ model.name }}</a></th>
                        {% else %}
                            <th scope="row">{{ model.name }}</th>
                        {% endif %}

                        {% if model.add_url %}
                            <td><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></td>
                        {% else %}
                            <td>&nbsp;</td>
                        {% endif %}

                        {% if model.admin_url %}
                            {% if model.view_only %}
                                <td><a href="{{ model.admin_url }}" class="viewlink">{% trans 'View' %}</a></td>
                            {% else %}
                                <td><a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a></td>
                            {% endif %}
                        {% else %}
                            <td>&nbsp;</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </table>
        </div>
    {% endfor %}
{% else %}
    <p>{% trans "You don't have permission to view or edit anything." %}</p>
{% endif %}

<script>
// Remove theme toggle and enhance admin functionality
document.addEventListener('DOMContentLoaded', function() {
    // Remove theme toggle buttons
    const themeToggles = document.querySelectorAll(
        '#theme-toggle, .theme-toggle, [data-theme-toggle], .dark-mode-toggle, ' +
        'button[aria-label*="theme"], button[title*="theme"], button[class*="theme"], ' +
        'a[class*="theme"], .toggle[class*="theme"], ' +
        'button[aria-label*="Dark"], button[aria-label*="Light"]'
    );
    
    themeToggles.forEach(function(element) {
        element.remove();
    });
    
    // Auto-refresh email stats every 30 seconds
    setInterval(function() {
        // You can add AJAX refresh logic here if needed
        console.log('Auto-refresh check for email stats');
    }, 30000);
    
    console.log('PulsePrep Enhanced Admin loaded');
});

// Nuclear approach for theme toggle removal
setInterval(function() {
    const buttons = document.querySelectorAll('button, a');
    buttons.forEach(btn => {
        const hasThemeIcon = btn.innerHTML.includes('moon') || 
                           btn.innerHTML.includes('sun') || 
                           btn.innerHTML.includes('theme') ||
                           btn.classList.toString().includes('theme') ||
                           btn.classList.toString().includes('dark') ||
                           btn.classList.toString().includes('light');
        if (hasThemeIcon) {
            btn.remove();
        }
    });
}, 500);
</script>
{% endblock %}